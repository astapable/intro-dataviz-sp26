<!DOCTYPE html>
<html>
<head>
  <title>D3.js Minimalist Clock</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .clock-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .clock-face {
      fill: #f5f5f5;
      stroke: #333;
      stroke-width: 2px;
    }
    .time-marker {
      fill: #4285f4;
      transition: all 0.5s ease;
    }
    .time-text {
      font-family: Arial, sans-serif;
      font-size: 18px;
      text-anchor: middle;
      dominant-baseline: middle;
    }
  </style>
</head>
<body>
  <div class="clock-container">
    <svg id="clock" width="300" height="300"></svg>
  </div>

  <script>
    // Set up the SVG container
    const svg = d3.select("#clock");
    const width = 300;
    const height = 300;
    const radius = Math.min(width, height) / 2 - 10;
    const centerX = width / 2;
    const centerY = height / 2;

    // Create the clock face
    svg.append("circle")
      .attr("cx", centerX)
      .attr("cy", centerY)
      .attr("r", radius)
      .attr("class", "clock-face");

    // Create 60 marker circles arranged around the face
    const totalMarkers = 60;
    const markersGroup = svg.append("g").attr("transform", `translate(${centerX}, ${centerY})`);

    const markersData = d3.range(totalMarkers).map(i => {
      const angle = (i / totalMarkers) * 2 * Math.PI - Math.PI / 2;
      return {
        index: i,
        angle,
        x: Math.cos(angle) * (radius * 0.8),
        y: Math.sin(angle) * (radius * 0.8)
      };
    });

    markersGroup.selectAll("circle")
      .data(markersData)
      .enter()
      .append("circle")
      .attr("class", "time-marker")
      .attr("cx", d => d.x)
      .attr("cy", d => d.y)
      .attr("r", 3)
      .attr("fill", "#4285f4");

    // Add text for displaying time
    const timeText = svg.append("text")
      .attr("x", centerX)
      .attr("y", centerY + radius / 2)
      .attr("class", "time-text");

    // Smooth animation: scale the 60 markers continuously based on fractional seconds
    function animate() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      const seconds = now.getSeconds();
      const ms = now.getMilliseconds();

      // fractional seconds (0..60)
      const fracSec = seconds + ms / 1000;

      // update each marker's radius based on distance (circular) to current fractional second
      markersGroup.selectAll("circle").attr("r", d => {
        // circular distance between marker index and current fractional second
        let diff = Math.abs(d.index - fracSec);
        if (diff > totalMarkers / 2) diff = totalMarkers - diff;
        // simple mapping: closer markers are larger. tweak divisor for falloff.
        const radiusVal = Math.max(2, 14 - diff);
        return radiusVal;
      });

      // update time text (integer display)
      timeText.text(`${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`);

      requestAnimationFrame(animate);
    }

    requestAnimationFrame(animate);
  </script>
</body>
</html>
